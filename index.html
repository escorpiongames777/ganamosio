<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plataforma Verificada</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Meta Pixel Code (verifica que el ID sea el correcto en tu BM) -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src='https://connect.facebook.net/en_US/fbevents.js';
    s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script');
    fbq('init', '24818917464366642');  /* <- revisa este ID */
    fbq('track', 'PageView');
  </script>
  <noscript>
    <img height="1" width="1" style="display:none"
      src="https://www.facebook.com/tr?id=24818917464366642&ev=PageView&noscript=1"/>
  </noscript>
  <!-- End Meta Pixel Code -->

  <style>
    :root{
      --wa-green: #25D366;
      --wa-green-dark: #1ebe57;
      --wa-green-soft: #e9f9ef;
      --text: #1a1a1a;
      --muted: #6b7280;
      --border: #e5e7eb;
      --white: #ffffff;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: var(--white);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    header { margin-top: 30px; text-align: center; }

    .logo-text { color: var(--wa-green); font-weight: 700; font-size: 26px; }

    hr {
      width: 100%;
      border: none;
      border-top: 1px solid var(--border);
      margin: 20px 0 10px;
    }

    .verified { text-align: center; padding-top: 10px; }
    .verified img { width: 64px; height: 64px; margin: 12px 0 10px; }
    .verified h2 { font-size: 22px; margin: 6px 0 4px; color: var(--text); font-weight: 700; }
    .verified .green { color: var(--wa-green); font-weight: 600; margin: 0; }

    .message {
      background: var(--wa-green-soft);
      padding: 14px 18px;
      border-radius: 14px;
      margin: 22px 0 24px;
      font-size: 16px;
      color: var(--text);
      border: 1px solid #d9f3e3;
      max-width: 640px;
    }

    .whatsapp-button {
      background-color: var(--wa-green);
      color: #ffffff;
      padding: 18px 30px;
      border-radius: 999px;
      font-weight: 800;
      letter-spacing: .3px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 22px;
      font-size: 18px;
      border: none;
      cursor: pointer;
      position: relative;
      transition: transform .2s ease, box-shadow .2s ease, background-color .2s ease;
      min-width: 260px;
      box-shadow: 0 8px 20px rgba(37,211,102,0.25);
    }

    .whatsapp-button:hover {
      transform: translateY(-2px);
      background-color: var(--wa-green-dark);
      box-shadow: 0 12px 26px rgba(37,211,102,0.32);
    }

    .whatsapp-button:active { transform: translateY(0); }

    .whatsapp-button i { margin-right: 10px; font-size: 22px; }

    @keyframes pulse {
      0%   { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.45); }
      70%  { box-shadow: 0 0 0 18px rgba(37, 211, 102, 0); }
      100% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); }
    }
    .whatsapp-button.pulse { animation: pulse 2.2s infinite; }

    .clientes {
      background-color: #f3f4f6;
      color: var(--text);
      padding: 12px 20px;
      border-radius: 999px;
      font-weight: 700;
      margin-bottom: 12px;
      border: 1px solid var(--border);
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }
    .clientes::before{
      content:"\f0c0";
      font: normal 16px/1 "Font Awesome 6 Free";
      font-weight: 900;
      color: var(--text);
      opacity:.85;
    }

    .trustpilot {
      font-size: 14px;
      padding: 12px 16px;
      border: 1px dashed #cbd5e1;
      border-radius: 14px;
      margin-bottom: 18px;
      text-align: center;
      color: var(--muted);
      background: #fafafa;
      max-width: 680px;
    }
    .trustpilot img { margin-top: 8px; max-width: 160px; }

    .footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: var(--wa-green);
      color: #ffffff;
      text-align: center;
      padding: 10px;
      font-weight: 800;
      font-size: 14px;
      letter-spacing: .2px;
    }

    @media (max-width: 600px) {
      .whatsapp-button { font-size: 16px; padding: 16px 24px; min-width: 220px; }
      .clientes { font-size: 14px; padding: 10px 16px; }
      .message { font-size: 14px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-text">Plataforma Verificada</div>
  </header>

  <hr />

  <section class="verified">
    <!-- El logo ahora tambi√©n abre WA con la misma l√≥gica -->
    <a href="#" target="_blank" rel="noopener noreferrer">
      <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp Logo" width="64" height="64" />
    </a>
    <h2>‚úÖ <b>Plataforma Verificada</b> ‚úÖ</h2>
    <p class="green">Casino de Confianza</p>
  </section>

  <div class="message">
    Te estamos conectando con nuestro equipo v√≠a WhatsApp.
  </div>

  <a id="whatsapp-button"
    class="whatsapp-button pulse"
    target="_blank" 
    rel="noopener noreferrer"
    href="https://wa.me/5491124985966?text=Quiero%20el%20bono%20del%2020%25">
    <i class="fab fa-whatsapp"></i> ¬°QUIERO MI BONO!
  </a>

  <div class="clientes">
    +10.000 CLIENTES GANANDO todos los d√≠as
  </div>

  <div class="trustpilot">
    "Excelente" ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Calificaci√≥n 4.9/5 en Trustpilot<br/>
    <img src="https://logowik.com/content/uploads/images/trustpilot-stars9095.jpg" alt="Trustpilot" />
  </div>

  <div class="footer">
    üéÅ BONO ACTIVO - ¬°Solic√≠talo ahora por WhatsApp!
  </div>

  <!-- Rotaci√≥n ponderada con memoria local -->
  <script>
  document.addEventListener('DOMContentLoaded', function () {
    // ======= Config =======
    const NUMBERS = [
      { id: "wa1", phone: "5491124985966" },
      { id: "wa2", phone: "5491171201922" },
      { id: "wa3", phone: "5491176300373" },
      { id: "wa4", phone: "5491138720699" }
    ];
    const DEFAULT_MSG = "Quiero el bono del 20%";
    const KEY_COUNTS  = "wa_counts_v2";
    const KEY_HISTORY = "wa_history_v2"; // evita repeticiones seguidas

    // ======= Helpers memoria local =======
    function readJSON(key, fallback) {
      try { return JSON.parse(localStorage.getItem(key)) ?? fallback; }
      catch { return fallback; }
    }
    function writeJSON(key, value) {
      localStorage.setItem(key, JSON.stringify(value));
    }

    // Cargar/Inicializar conteos e historial
    const counts = readJSON(KEY_COUNTS, {});
    for (const n of NUMBERS) {
      if (typeof counts[n.id] !== "number") counts[n.id] = 0;
    }
    const history = readJSON(KEY_HISTORY, []); // guarda ids; m√°x 5 √∫ltimos

    // Peso base: menos usado => m√°s probabilidad
    function weightOf(n) {
      return 1 / ((counts[n.id] || 0) + 1);
    }
    // Penaliza suavemente si ese id sali√≥ hace poco (evita repeticiones)
    function historyPenalty(id) {
      const idx = history.lastIndexOf(id);
      if (idx === -1) return 1; // no apareci√≥ recientemente
      const distance = history.length - idx; // 1 = fue el √∫ltimo
      return Math.max(0.35, Math.min(1, distance / 5));
    }

    // Sorteo ponderado (ruleta) con penalizaci√≥n por historial
    function pickWeighted() {
      const weights = NUMBERS.map(n => weightOf(n) * historyPenalty(n.id));
      const total = weights.reduce((a,b) => a + b, 0);
      let r = Math.random() * total;
      for (let i = 0; i < NUMBERS.length; i++) {
        r -= weights[i];
        if (r <= 0) return NUMBERS[i];
      }
      return NUMBERS[NUMBERS.length - 1];
    }

    // Para tests: ?wa=1..4 fuerza la l√≠nea (opcional)
    function forcedByQuery() {
      const p = new URLSearchParams(location.search);
      const idxStr = p.get("wa");
      if (!idxStr) return null;
      const idx = parseInt(idxStr, 10) - 1;
      if (Number.isInteger(idx) && idx >= 0 && idx < NUMBERS.length) {
        return NUMBERS[idx];
      }
      return null;
    }

    function chooseNumber() {
      return forcedByQuery() || pickWeighted();
    }

    function registerUse(id) {
      counts[id] = (counts[id] || 0) + 1;
      writeJSON(KEY_COUNTS, counts);

      history.push(id);
      if (history.length > 5) history.shift();
      writeJSON(KEY_HISTORY, history);
    }

    function buildWaUrl(phone, text) {
      return `https://wa.me/${phone}?text=${encodeURIComponent(text || DEFAULT_MSG)}`;
    }

    // ======= Enlaces =======
    const whatsappBtn = document.getElementById("whatsapp-button");
    const waLogoLink  = document.querySelector(".verified a");

    // HREF inicial (por si alguien copia el link)
    if (whatsappBtn) {
      const init = chooseNumber();
      whatsappBtn.setAttribute("href", buildWaUrl(init.phone, DEFAULT_MSG));
    }

    function handleOpen(e, customText) {
      e.preventDefault(); // aseguramos setear URL antes de abrir
      const chosen = chooseNumber();
      registerUse(chosen.id);

      // Tracking (intenta, sin romper si fbq no est√°)
      try {
        fbq('track', 'Lead', { content_name: 'Registro', phone: chosen.phone });
        fbq('trackCustom', 'Registro', { phone: chosen.phone });
      } catch(_) {}

      const finalUrl = buildWaUrl(chosen.phone, customText || DEFAULT_MSG);
      // Abrimos controladamente (evita race con href viejo)
      window.open(finalUrl, "_blank", "noopener,noreferrer");
    }

    if (whatsappBtn) {
      whatsappBtn.addEventListener("click", (e) => handleOpen(e));
    }
    if (waLogoLink) {
      waLogoLink.addEventListener("click", (e) => handleOpen(e));
    }
  });
  </script>
</body>
</html>
